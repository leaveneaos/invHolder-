<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>发票详情</title>
	<meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
	<link rel="stylesheet" type="text/css" href="css/common.css">
	<link rel="stylesheet" type="text/css" href="css/fpxq.css">
	<link rel="stylesheet" type="text/css" href="../js/swipeslider.css">
	<script src="http://www.jq22.com/jquery/jquery-1.10.2.js"></script>
	<script type="text/javascript" src="../js/swipeslider.min.js"></script>
</head>
<body>
	<header>
		<img src="../images/nav.png">
	</header>
	<section class="main">
		<input type="hidden" id="orderNo"/>
		<input type="hidden" id="je"/>
		<input type="hidden" id="orderTime"/>
		<div class="shadow1"></div>
		<div class="shadow2"></div>
		<div class="content">
			<div class="contentTopBox">
				<div class="contentTopBox-form" style="margin: 30px auto">
					<img width="100%" height="50px"  src="../images/headcover.gif" alt="">
					<input type="text" id="gfmText"  placeholder="请输入购方名称">
					<p class="contentTopBox-formTitle" style="display: none;color: red;font-size: 12px">您输入的购方名称没有匹配，请重新输入！</p>
					<p style="color: #999999;font-size: 12px">友情提示：尊敬的电票用户为了您的信息安全，如需再次扫描二维码提取已开具的电子发票，请输入首次开票时所填入的购方名称验证。</p>
						<button id="sureOk" style="margin: 40px auto" >确认</button>
				</div>
			</div>
			<div class="topName">
				电子发票
			</div>
			<div class="middle" >
				<!--************************************************************************************-->
		       <!--<ul>-->
		            <!--<li class="fl">销方名称</li>-->
		            <!--<li class="fr omit" id="xfmc"></li>-->
		        <!--</ul>-->
		         <!--<ul>-->
		            <!--<li class="fl">购方名称</li>-->
		            <!--<li class="fr omit" id="gfmc"></li>-->
		        <!--</ul>-->
		        <!--<ul>-->
		            <!--<li class="fl">发票金额</li>-->
		            <!--<li class="fr omit" id="fpje"></li>-->
		        <!--</ul>-->
		        <!--<ul class="kprq">-->
		            <!--<li class="fl">开票日期</li>-->
		            <!--<li class="fr omit" id="kprq"></li>-->
		        <!--</ul>-->
		        <!--<ul>-->
		            <!--<li class="fl">发票代码</li>-->
		            <!--<li class="fr omit" id="fpdm"></li>-->
		        <!--</ul>-->
		        <!--<ul>-->
		            <!--<li class="fl">发票号码</li>-->
		            <!--<li class="fr omit" id="fphm"></li>-->
		        <!--</ul>-->
		        <!--<div  class="ck">-->
					<!--<a id="pdf" >查看发票</a>-->
		        <!--</div>-->
				<!--************************************************************************************-->
			</div>
			<div class="bottom btoTip">
				<div id="emilBox" >
					<h4 class="save">您还可以通过以下方式保存发票：</h4>

					<a href="../youxiang1.html" class="yx">
						<svg class="icon" aria-hidden="true">
							<use xlink:href="#icon-youxiang1"></use>
						</svg>
						<span>邮箱</span>
					</a>
					<a href="javascript:void(0);" class="wx" style="display: none">
						<svg class="icon" aria-hidden="true">
							<use xlink:href="#icon-weixin"></use>
						</svg>
						<span>微信</span>
					</a>
					<a href="javascript:void(0);" class="zfb" style="display: none">
						<svg class="icon" aria-hidden="true">
							<use xlink:href="#icon-zhifubao"></use>
						</svg>
						<span>支付宝</span>
					</a>
				</div>

				<figure id="full_feature" class="swipslider">
					<ul class="sw-slides">
						<li class="sw-slide">
							<img src="../images/banner/20180601135148.jpg" onclick="window.location.href='https://creditcard.ecitic.com/citiccard/cardshop-h5/wap/initCardInfo.do?pid=CS0002&foot_s=0&head_s=0&sid=SJBDZBL22'" alt="Summer beach concept">
						</li>
						<li class="sw-slide">
							<img src="../images/banner/SJBDZBL22-518.gif" onclick="window.location.href='https://creditcard.ecitic.com/h5/shenqing/?foot_s=0&head_s=0&sid=SJBDZBL22'" alt="Lang from Yie Ar Kung Fu">
						</li>
						<li class="sw-slide">
							<img src="../images/banner/xiaobanner.gif" onclick="window.location.href='http://kpt.datarj.com/#/product'" alt="Lang from Yie Ar Kung Fu">
						</li>
					</ul>
				</figure>
			</div>

		</div>
	</section>
	<footer>
		<p class="company fl">开票通电子发票云平台</p>
		<p class="help fr"><a href="../bangzhu.html">遇到问题?</a></p>
	</footer>
	<!--<script src="../js/jquery.min.js"></script>-->
	<script src="../js/iconfont.js"></script>
	<script type="text/javascript">
        $(window).load(function() {
            $('#full_feature').swipeslider();
        });
        $(function () {
            var listArry=[];
            var isPc=false;
            var ua = navigator.userAgent.toLowerCase();
            var isWeixin = ua.indexOf('micromessenger') != -1;
            var isAlipay = ua.indexOf('alipay') != -1;
            if(isWeixin){
                $(".zfb").css('display','none');
                $(".wx").css('display',"");
                isPc=true;
            }
            if(isAlipay){
                $(".zfb").css('display',"");
                $(".wx").css('display','none');
                isPc=true;
            }
            var thisURL = document.URL;
            var getval = thisURL.split('?')[1];
            var orderNo = getval.split("=")[2];
            var je = getval.split("=")[3];
            var orderTime = getval.split("=")[4];
			gsmc = getval.split("=")[5];
            $('#orderNo').val(orderNo);
            $('#je').val(je);
            $('#orderTime').val(orderTime);
            $.post(
                "../fm/fpsession",
                {},
                function (data) {
					var items = data.kplsList;
                    console.log(items);
                    listArry=items;
                    var html='';
                    for(var i = 0; i < items.length; i++) {
                        html+='<ul><li class="fl">销方名称</li><li class="fr omit" id="xfmc">'+items[i].xfmc+'</li></ul><ul><li class="fl">购方名称</li><li class="fr omit" id="gfmc">'+items[i].gfmc+'</li></ul> <ul><li class="fl">开票金额</li><li class="fr omit" id="kpje">'+RetainedDecimalPlaces(items[i].jshj)+"元"+'</li></ul><ul><li class="fl">开票日期</li><li class="fr omit" id="kprq">'+items[i].kprq+'</li></ul><ul><li class="fl">发票代码</li><li class="fr omit" id="fpdm">'+items[i].fpdm+'</li></ul> <ul><li class="fl">发票号码</li><li class="fr omit" id="fphm">'+items[i].fphm+'</li></ul><div class="ck"><a id="pdf" href='+items[i].pdfurl+'>查看发票</a></div>';
                    }
                    //在页面显示数据
                    $(".middle").html(html);
                }
            )

			if(!isPc){
                $(".contentTopBox").css("display",'none');
                $("#emilBox").css("display",'block');
			}

            $("#sureOk").click(function(){
                var textValue=document.getElementById('gfmText').value.trim();
                // var textValue=$("#gfmText").val().trim();
				var str='';
				for(var i=0;i<textValue.length;i++){
				    if(textValue.substring(i,i+1)=='（'){
                        str=str+'(';
					}else if(textValue.substring(i,i+1)=='）'){
                        str=str+')';
					}else{
				        str=str+textValue.substring(i,i+1);
					}
				}
                listArry.forEach(function (value,index) {
                    var str2='';
                    var mc=value.gfmc.trim();
                    for(var i=0;i<mc.length;i++){
                        if(mc.substring(i,i+1)=='（'){
                            str=str+'(';
                        }else if(mc.substring(i,i+1)=='）'){
                            str=str+')';
                        }else{
                            str=str+mc.substring(i,i+1);
                        }
                    }
					if(str==str2){
					    $(".contentTopBox").css("display",'none');
                        $("#emilBox").css("display",'block');
						return false;
					}
                })
				$('.contentTopBox-formTitle').css("display",'block')

            })
        })



        $(".zfb").click(function () {
            window.location = "../syncAlipay?_t=" + (new Date()).getTime();
        });

         $(".wx").click(function () {
             var orderNo = $('#orderNo').val();
             var je = $('#je').val();
             var orderTime = $('#orderTime').val();
             /*if(xgsdm!=null&&xgsdm!=""){
                 var orderNo = xgsdm+"-"+$('#orderNo').val();
			 }*/
             window.location = "../common/syncWeiXin?orderNo="+orderNo+"&price="+je+"&orderTime="+orderTime+"&gsdm="+gsmc;
         });
        function RetainedDecimalPlaces(num) {
            num = parseFloat(num).toFixed(2);
            var source = String(num).split(".");
            source[0] = source[0].replace(new RegExp('(\\d)(?=(\\d{3})+$)', 'ig'), "$1,");
            return source.join(".");
        };
	</script>
</body>
</html>
