<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>订单确认</title>
	<meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
	<link rel="stylesheet" type="text/css" href="css/common.css">
	<link rel="stylesheet" type="text/css" href="css/ddqr.css">
</head>
<body>
	<header>
		<img id="logo" src="images/rjxx.jpg"/>
	</header>
	<section class="main">
		<div class="shadow1"></div>
		<div class="shadow2"></div>
		<div class="content">
			<div class="middle" >
		         <ul>
		            <li class="fl">订单编号 :</li>
		            <li class="fr omit" id="order"></li>
		        </ul>
		        <ul>
		            <li class="fl">交易日期 :</li>
		            <li class="fr omit" id="orderTime"></li>
		        </ul>
		        <ul>
		            <li class="fl">合计金额 :</li>
		            <li class="fr omit" id="price" ></li>
		        </ul>
			</div>
			<div class="bottom" style="margin-left: 10%">
				<input type="hidden" id="tqmhidden">
				<button id="sure" type="submit" onclick="sure()">确&nbsp;&nbsp;&nbsp;&nbsp;认</button>
			</div>
		</div>
	</section>
	<footer>
		<p class="company fl">泰易电子发票云服务平台</p>
		<p class="help fr"><a href="bangzhu.html">遇到问题?</a></p>
	</footer>

	<script src="js/jquery.min.js"></script>
	<script type="text/javascript">
		var msg=null;
        function redirect(errorMsg){
            var myurl = "QR/error.html?msg="+new Date+"="+errorMsg;
            window.location.assign(encodeURI(myurl));
        }
        pricese=null;
		$(function () {
            var thisURL = document.URL;
            var  getval =thisURL.split('?')[1];
            gsmc = null
            orderNo= null;
            price=null;
            orderTime=null;
			storeNo="";
            gsmc = getval.split("=")[2];
            orderNo = getval.split("=")[3];
            price = getval.split("=")[4];
            orderTime = getval.split("=")[4];
            if(gsmc == null || orderNo ==null || price==null || orderTime ==null){
                redirect("出现未知错误，请重新扫码或联系商户！")
			}else {
				$('#order').html(orderNo);
				$('#orderTime').html(orderTime);
				$('#price').html(RetainedDecimalPlaces(price)+"元");
				$('#tqmhidden').html(orderNo);
                $("#logo").attr("src", "images/" + gsmc + ".png");
			}

	    });

        function RetainedDecimalPlaces(num) {
            num = parseFloat(num).toFixed(2);
            var source = String(num).split(".");
            source[0] = source[0].replace(new RegExp('(\\d)(?=(\\d{3})+$)', 'ig'), "$1,");
            return source.join(".");
        };
        function sure() {
			var tqm=$('#tqmhidden').text();
			if(tqm!=null){
            var ua = navigator.userAgent.toLowerCase();
            var isWeixin = ua.indexOf('micromessenger') != -1;
            var isAlipay = ua.indexOf('alipay') != -1;
            if(isAlipay){
                window.location.href = "mbfptt.html?gsdm="+gsmc+"&&tqm="+ tqm +"&&time=" + new Date();
            }else if(isWeixin){
                window.location = "common/isBrowser?orderNo=" + orderNo + "&orderTime=" + orderTime +
                    "&storeNo=" + storeNo + "&price=" + pricese;
            }
            else {
                window.location.href = "mbfptt.html?gsdm="+ gsmc +"&&tqm="+ tqm +"&&time=" + new Date();
			}
             }else{
                 alert("数据异常！不能提交！");
			 }
        }
	</script>
</body>
</html>
