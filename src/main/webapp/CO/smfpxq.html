<!DOCTYPE html>
<html lang="en">
<head>

	<meta charset="UTF-8">
	<title>发票详情</title>
	<meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
	<link rel="stylesheet" type="text/css" href="../Family/css/common.css">
	<link rel="stylesheet" type="text/css" href="../Family/css/fpxq.css">
	<style>
		.middle li.fl {
			width: 25%;
		}
		.middle li.fr {
			width: 70%;
		}
		.middle ul{
			height: 40px;
			text-indent: 17px;
		}
	</style>
</head>
<body >
	<header>
	</header>
	<section class="main" style="width: 92%">
		<div class="content">
			<div class="middle" style="margin-top: 15px;">
				<div style="text-align: center;padding: 5%">增值税电子普通发票</div>
				<div class="fpxq">
				</div>
			</div>
			<div class="bottom btoTip">
				<a href="../youxiang1.html" class="yx">
					<svg class="icon" aria-hidden="true">
						<use xlink:href="#icon-youxiang1"></use>
					</svg>
					<span>邮箱</span>
				</a>
				<a href="javascript:void(0);" class="wx" style="display: none">
					<svg class="icon" aria-hidden="true">
						<use xlink:href="#icon-weixin"></use>
					</svg>
					<span>微信</span>
				</a>
				<a href="javascript:void(0);" class="zfb" style="display: none">
					<svg class="icon" aria-hidden="true">
						<use xlink:href="#icon-zhifubao"></use>
					</svg>
					<span>支付宝</span>
				</a>
			</div>
		</div>
	</section>
	<footer>
		<p class="company fl">泰易开票通</p>
		<p class="help fr"><a href="../bangzhu.html">遇到问题?</a></p>
	</footer>
	<script src="../js/jquery.min.js"></script>
	<script src="../js/iconfont.js"></script>
	<script type="text/javascript">
        function redirect(errorMsg){
            var myurl = "../QR/error.html?msg="+new Date+"="+errorMsg;
            window.location.assign(encodeURI(myurl));
        }
        var serialOrder =location.href.split('?')[1].split('&')[0].split('=')[1];
		orderNo = null;
		orderTime = null;
		price =null;
		var gsdms="";
      	$(function () {
			  var ua = navigator.userAgent.toLowerCase();
			  var isWeixin = ua.indexOf('micromessenger') != -1;
			  var isAlipay = ua.indexOf('alipay') != -1;
			  if(isWeixin){
				  $(".zfb").css('display','none');
				  $(".wx").css('display',"");
			  }
			  if(isAlipay){
				  $(".zfb").css('display',"");
				  $(".wx").css('display','none');
			  }
            $.post(
                "../common/smfpxq",
                {
                    "serialOrder":serialOrder
				},
                function (data) {
					if(data.msg!=null&&data.msg!=""){
                        redirect(data.msg);
					}else {
                        orderNo = data.orderNo;
                        price = data.price;
                        orderTime = data.orderTime;
                        gsdms=data.gsdm;
                        if(data.gsdm!=null&&data.gsdm=='gvc'){
                            $(".company").css('display','none');
                            $(".help").css('display','none');
                        }
                        var items = data.kplsList;
                        var html='';
                        for(var i = 0; i < items.length; i++) {
                            html+='<div class="fpxqxx" style="background-color: white;padding-bottom: 20px;"><ul><li class="fl">销方名称</li><li class="fr omit" id="xfmc">'+items[i].xfmc+'</li></ul><ul><li class="fl">购方名称</li><li class="fr omit" id="gfmc">'+items[i].gfmc+'</li></ul> <ul><li class="fl">开票金额</li><li class="fr omit" id="kpje">'+RetainedDecimalPlaces(items[i].jshj)+"元"+'</li></ul><ul><li class="fl">开票日期</li><li class="fr omit" id="kprq">'+items[i].kprq+'</li></ul><ul><li class="fl">发票代码</li><li class="fr omit" id="fpdm">'+items[i].fpdm+'</li></ul> <ul><li class="fl">发票号码</li><li class="fr omit" id="fphm">'+items[i].fphm+'</li></ul><div class="ck"><a id="pdf" href='+items[i].pdfurl+'>查看发票</a></div></div>';
                        }
                        //在页面显示数据
                        $(".fpxq").html(html);
					}

                }
            )
        })
            //归入支付宝发票管家
            $(".zfb").click(function () {
                window.location = "../syncAlipay?_t=" + (new Date()).getTime();
            });
            //归入微信卡包
            $(".wx").click(function () {
                if(null==orderNo || null==price||orderTime==null){
                    redirect("归入微信卡包出现未知错误，请重试！");
                    return;
                }
                if(gsdms==null || gsdms==""){
                    redirect("归入微信卡包出现未知错误，请重试！");
                    return;
				}
                window.location = "../common/syncWeiXin?orderNo="+orderNo+"&price="+price+"&orderTime="+orderTime+"&gsdm="+gsdms;
            });

        //金额千位分隔2
        function RetainedDecimalPlaces(num) {
            num = parseFloat(num).toFixed(2);
            var source = String(num).split(".");
            source[0] = source[0].replace(new RegExp('(\\d)(?=(\\d{3})+$)', 'ig'), "$1,");
            return source.join(".");
        };
	</script>
</body>
</html>
