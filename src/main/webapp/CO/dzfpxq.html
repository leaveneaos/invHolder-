<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>电子发票</title>
	<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">

	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="apple-mobile-web-app-status-bar-style" content="black">

	<meta http-equiv="Expires" content="0">
	<meta http-equiv="Pragma" content="no-cache">
	<meta http-equiv="Cache-control" content="no-cache">
	<meta http-equiv="Cache" content="no-cache">

	<link rel="stylesheet" type="text/css" href="../css/common.css">
	<!--标准mui.css-->
	<link rel="stylesheet" href="../css/mui.min.css">
	<!--App自定义的css-->
	<link rel="stylesheet" type="text/css" href="../css/app.css" />
	<style>
		.data-dtc {
			font-size: 14.0px;
			border-radius: 5px;
			border-width: 1px;
			background-color: white;
			pointer-events: auto;
			margin: 10px;
			padding: 10px;
			border-bottom: 1px dashed #45457d;
		}
		.omit {
			overflow: hidden;
			white-space: nowrap;
			text-overflow: ellipsis;
		}
		.data-dtc li.fl {
			width: 28%;
			color: #7B7F87;
			margin-left: -6%;
		}
		.fl{
			float: left;
		}
		body{
			background-color: #4AA6E6;
		}
		.data-dtc ul {
			font-size: 14px;
			line-height: 30px;
			margin: 0 auto;
			box-sizing: border-box;
			text-indent: 10px;
		}
		.data-dtc li {
			height: 30px;
			font-size: 14px;
			line-height: 30px;
			margin: 0 auto;
			box-sizing: border-box;
			text-indent: 10px;
		}
		.oss{
			cursor: pointer;
			float: right;
			font-size: 16px;
			margin-right: 5%;
			margin-top: -6%;
		}
		.more{
			float: right;
			margin-right: 9%;
		}
		.main{
			margin: 15px auto 30px;
			width: 92%;
		}
		.content{
			background-color: #fff;
			border-radius: 10px;
			position: relative;
		}
		.contentTopBox{
			position: absolute;
			width: 100%;
			height: 100%;
			background-color: #ffffff;
		}
		.contentTopBox-form{
			width: 80%;
			margin: 100px auto;
		}
		#sureOk{
			width: 20%;
			background-color: #4BB4F7;
			list-style-type: none;
			color: #fff;
			border-radius: 5px;
			float: right;
		}
		#gfmText{
			width: 70%;
			height: 38px;

		}
		.middle{
			padding: 5%;
		}
		footer{
			background-color: transparent;
			border: none;
			padding: 0 20px;
		}
	</style>
</head>
<body>
	<header>
	</header>
	<input id="hide"  type="hidden">
	<section class="main">
		<div class="content">
			<div class="contentTopBox">
				<div class="contentTopBox-form" style="margin: 30px auto">
					<img width="100%" height="50px"  src="../images/headcover.gif" alt="">
					<input type="text" id="gfmText"  placeholder="请输入购方名称">
					<p class="contentTopBox-formTitle" style="display: none;color: red;font-size: 12px">您输入的购方名称没有匹配，请重新输入！</p>
					<p style="color: #999999;font-size: 12px">友情提示：尊敬的电票用户为了您的信息安全，如需再次扫描二维码提取已开具的电子发票，请输入首次开票时所填入的购方名称验证。</p>
					<button id="sureOk" style="margin: 40px auto" >确认</button>
				</div>
			</div>
		<div class="middle">
			<div style="text-align: center;">增值税电子普通发票</div>
		</div>
			<div class="more">
				<a class="pp"     style="display: none">更多</a>
				<a class="ps"  style="display: none">收起</a>
			</div>
		<div id="th">
		</div>
		<!--<div class="data-dtc">
				<ul>
					<li class="fl">开票日期</li>
					<li class="fr omit" id="xfmc">1111</li>
				</ul>
				<ul>
					<li class="fl">发票代码</li>
					<li class="fr omit" id="gfmc">11</li>
				</ul>
				<ul>
					<li class="fl">发票号码</li>
					<li class="fr omit" id="fpje">111</li>
					<a class="oss"   onclick=""> > </a>
				</ul>

				<ul class="kprq">
					<li class="fl">购方名称</li>
					<li class="fr omit" id="kprq">111</li>
				</ul>
				<ul>
					<li class="fl">价税合计</li>
					<li class="fr omit" id="fpdm">111</li>
				</ul>
		</div>-->

		</div>
	</section>
	
	<footer>
		<p class="company fl">泰易开票通</p>
		<p class="help fr"><a href="../bangzhu.html">遇到问题?</a></p>
	</footer>

	<script src="../js/mui.min.js"></script>
	<script src="../js/fpj.js" type="text/javascript"></script>
	<script src="../js/jquery.min.js"></script>

	<script type="text/javascript">
        function redirect(errorMsg){
            var myurl = "../QR/error.html?msg="+new Date+"="+errorMsg;
            window.location.assign(encodeURI(myurl));
        }
		$(function(){
            var listArry=[];
            var isPc=false;
            var ua = navigator.userAgent.toLowerCase();
            var isWeixin = ua.indexOf('micromessenger') != -1;
            var isAlipay = ua.indexOf('alipay') != -1;
            if(isWeixin){
                isPc=true;
            }
            if(isAlipay){
                isPc=true;
            }
            $.post(
                "../tq/fpxx",
                {},
                function(data) {
                    if(data.msg!=null && data.msg=="0"){
                        redirect("没有找到发票信息，请重试！");
					}else {
                    var items = data.kplsList;
                        listArry=items;
                    var html='';
                    for(var i = 0; i < items.length; i++){
                        if(i>2){
                            $('.pp').css('display',"block");
                            $('.ps').css('display','none');
                        }
                        //html+='<div class="data-dtc"><ul><li class="fl" >开票日期</li><li class="fr omit" id="kprq">'+items[i].kprq+'</li></ul><ul><li class="fl">发票代码</li><li class="fr omit" id="fpdm">'+items[i].fpdm+'</li></ul><ul><li class="fl">发票号码</li><li class="fr omit" id="fphm">'+items[i].fphm+'</li><a class="oss" id="tz" href="dzxfp.html?gsdm='+items[i].gsdm+'&&tqm='+items[i].tqm+'&&time='+new Date()+'"> 查看> </a></ul><ul><li class="fl">购方名称</li><li class="fr omit" id="gfmc">'+items[i].gfmc+'</li></ul><ul><li class="fl">价税合计</li><li class="fr omit" id="jshj">'+RetainedDecimalPlaces(items[i].jshj)+"元"+'</li></ul></div>';
                        html+='<div class="data-dtc"><ul><li class="fl" >开票日期</li><li class="fr omit" id="kprq">'+items[i].kprq+'</li></ul><ul><li class="fl">发票代码</li><li class="fr omit" id="fpdm">'+items[i].fpdm+'</li></ul><ul><li class="fl">发票号码</li><li class="fr omit" id="fphm">'+items[i].fphm+'</li><a class="oss" id="tz" href="dzxfp.html?s='+i+'&&time='+new Date()+'"> 查看> </a></ul><ul><li class="fl">购方名称</li><li class="fr omit" id="gfmc">'+items[i].gfmc+'</li></ul><ul><li class="fl">合计金额</li><li class="fr omit" id="jshj">'+RetainedDecimalPlaces(items[i].jshj)+"元"+'</li></ul></div>';
                    }
                    //在页面显示数据
                    $("#th").html(html);
                    $("#th div:gt(2)").each(function(){
                        $(this).hide();
                    })
                    }
                }
            )
            if(!isPc){
                $(".contentTopBox").css("display",'none');
                $(".btoTip").css("display",'block');
            }
            $("#sureOk").click(function(){
                var textValue=document.getElementById('gfmText').value.trim();
                var str='';
                for(var i=0;i<textValue.length;i++){
                    if(textValue.substring(i,i+1)=='（'){
                        str=str+'(';
                    }else if(textValue.substring(i,i+1)=='）'){
                        str=str+')';
                    }else{
                        str=str+textValue.substring(i,i+1);
                    }
                }
                listArry.forEach(function (value,index) {
                    var str2='';
                    var mc=value.gfmc;
                    for(var i=0;i<mc.length;i++){
                        if(mc.substring(i,i+1)=='（'){
                            str=str+'(';
                        }else if(mc.substring(i,i+1)=='）'){
                            str=str+')';
                        }else{
                            str=str+mc.substring(i,i+1);
                        }
                    }
                    if(str==str2){
                        $(".contentTopBox").css("display",'none');
                        $("#emilBox").css("display",'block');
                        return false;
                    }
                })
                $('.contentTopBox-formTitle').css("display",'block')

            })
		})
        function RetainedDecimalPlaces(num) {
            num = parseFloat(num).toFixed(2);
            var source = String(num).split(".");
            source[0] = source[0].replace(new RegExp('(\\d)(?=(\\d{3})+$)', 'ig'), "$1,");
            return source.join(".");
        };
        $(".pp").click(function () {
           	 $('.data-dtc').css('display',"");
            $('.ps').css('display',"");
            $('.pp').css('display','none');
        })
        $(".ps").click(function () {
            $("#th div:gt(2)").each(function(){
                $(this).hide();
            })
            $('.pp').css('display',"");
            $('.ps').css('display','none');
        })
	</script>
</body>
</html>